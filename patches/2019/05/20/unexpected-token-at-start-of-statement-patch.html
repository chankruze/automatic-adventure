<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Workaround to fix unexpected token at start of statement error with clang</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" type="text/css" href="/assets/bootstrap/css/bootstrap.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="/assets/fontawesome/css/all.css">
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/assets/css/index.css">
    <link rel="stylesheet" href="/assets/css/404.css">
    <link rel="stylesheet" href="/assets/css/post.css">
    <link type="application/atom+xml" rel="alternate" href="/feed.xml" title="GEEKOFIA" />
    <!-- Begin Jekyll SEO tag v2.6.0 -->
<title>Workaround to fix unexpected token at start of statement error with clang | GEEKOFIA</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Workaround to fix unexpected token at start of statement error with clang" />
<meta name="author" content="chankruze" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="My life is a litle bit weired. I never got success on first attempt, there is always some errors, bugs. So, now-a-days seeing an error is a normal thing for me. To be honest i think if there were no struggle to get things working, maybe i couldn’t be here. Now come to the actual issue, what error do we have here ?" />
<meta property="og:description" content="My life is a litle bit weired. I never got success on first attempt, there is always some errors, bugs. So, now-a-days seeing an error is a normal thing for me. To be honest i think if there were no struggle to get things working, maybe i couldn’t be here. Now come to the actual issue, what error do we have here ?" />
<link rel="canonical" href="/patches/2019/05/20/unexpected-token-at-start-of-statement-patch.html" />
<meta property="og:url" content="/patches/2019/05/20/unexpected-token-at-start-of-statement-patch.html" />
<meta property="og:site_name" content="GEEKOFIA" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-05-20T07:27:34+05:30" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"/patches/2019/05/20/unexpected-token-at-start-of-statement-patch.html","author":{"@type":"Person","name":"chankruze"},"headline":"Workaround to fix unexpected token at start of statement error with clang","dateModified":"2019-05-20T07:27:34+05:30","datePublished":"2019-05-20T07:27:34+05:30","description":"My life is a litle bit weired. I never got success on first attempt, there is always some errors, bugs. So, now-a-days seeing an error is a normal thing for me. To be honest i think if there were no struggle to get things working, maybe i couldn’t be here. Now come to the actual issue, what error do we have here ?","mainEntityOfPage":{"@type":"WebPage","@id":"/patches/2019/05/20/unexpected-token-at-start-of-statement-patch.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
    <!-- Navbar -->
    <!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
    <a class="navbar-brand" href="#"><i class="fas fa-blog"></i> GEEKOFIA #Blog</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText"
        aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarText">
        <ul class="navbar-nav mr-auto">
            
            <li class="nav-item">
                <a href="https://geekofia.in" class="nav-link" data-toggle="tooltip" title="GEEKOFIA Home Page"
                    >
                    Home
                </a>
            </li>
            
            <li class="nav-item">
                <a href="/" class="nav-link" data-toggle="tooltip" title="Latest Blog Posts"
                    >
                    Recent Blogs
                </a>
            </li>
            
            <li class="nav-item">
                <a href="/android/" class="nav-link" data-toggle="tooltip" title="Latest Android Posts"
                    >
                    Android
                </a>
            </li>
            
            <li class="nav-item">
                <a href="/programming/" class="nav-link" data-toggle="tooltip" title="Latest Programming Posts"
                    >
                    Programming
                </a>
            </li>
            
            <li class="nav-item">
                <a href="/hacking/" class="nav-link" data-toggle="tooltip" title="Latest Cyber Security Blog Posts"
                    >
                    Cyber Security
                </a>
            </li>
            
            <li class="nav-item">
                <a href="/ctf/" class="nav-link" data-toggle="tooltip" title="Latest CTF Posts"
                    >
                    CTF
                </a>
            </li>
            
            <li class="nav-item">
                <a href="/miscellaneous/" class="nav-link" data-toggle="tooltip" title="Miscellaneous Blog Posts"
                    >
                    Miscellaneous
                </a>
            </li>
            
            <li class="nav-item">
                <a href="/staffs/" class="nav-link" data-toggle="tooltip" title="About Our Authors"
                    >
                    Staffs
                </a>
            </li>
            
            <li class="nav-item">
                <a href="/contact/" class="nav-link" data-toggle="tooltip" title="Reach us"
                    >
                    Contact
                </a>
            </li>
            
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                    title="Posts by tags">
                    Tags
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                    
                    <a href="/tags/compilation_error/" class="dropdown-item">
                        compilation_error
                    </a>
                    
                    <a href="/tags/kernel/" class="dropdown-item">
                        kernel
                    </a>
                    
                    <a href="/tags/android/" class="dropdown-item">
                        android
                    </a>
                    
                    <a href="/tags/patch/" class="dropdown-item">
                        patch
                    </a>
                    
                </div>
            </li>
        </ul>

        <div class="nav nav-social">
            <a class="nav-item" href="https://github.com/chankruze" target="_blank"><i class="fab fa-github"></i></a>
            <a class="nav-item" href="https://instagram.com/chankruze" target="_blank"><i class="fab fa-instagram"></i></a>
            <a class="nav-item" href="https://t.me/geekofia" target="_blank"><i class="fab fa-telegram"></i></a>
        </div>

        <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="search" placeholder="Search blog.geekofia.in" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0 btn-search" type="submit">Search</button>
        </form>
    </div>
</nav>

    <div class="container content">
        <!-- Rendered Content-->
        <div>
  <button class="btn-back" onclick="goBack()">Go Back</button>
  <h1>Workaround to fix unexpected token at start of statement error with clang</h1>
</div>

<p><i class="fas fa-calendar"></i>
  20 May 2019
  
  
  <i class="fas fa-user-edit"></i> <a href="/authors/chankruze.html">Chandan Kumar Mandal</a>
  
</p>

<p><i class="fas fa-tags"></i>
  
  <a class="tags" href="/tags/compilation_error/">compilation_error</a>
  
  <a class="tags" href="/tags/kernel/">kernel</a>
  
  <a class="tags" href="/tags/android/">android</a>
  
  <a class="tags" href="/tags/patch/">patch</a>
  
</p>

<p>My life is a litle bit weired. I never got success on first attempt, there is always some errors, bugs. So, now-a-days seeing an error
is a normal thing for me. To be honest i think if there were no struggle to get things working, maybe i couldn’t be here. Now come to the
actual issue, what error do we have here ?
<!--excerpt-->
Following terminal snippet has the error that i got while compiling kernel for Realme 2 Pro (stanlee). It was saying <code class="highlighter-rouge">error: unexpected token at start of statement</code>.</p>

<figure>
<figcaption>terminal snippet</figcaption>
<pre class="prettyprint linenums">
<code>
<font color="#4E9A06"><b>chankruze@hpnightowl</b></font>:<font color="#3465A4"><b>~/N00bKernel</b></font>$ ccache make ARCH=arm64 CC=clang CLANG_TRIPLE=aarch64-linux-gnu- CROSS_COMPILE_PREFIX=aarch64-linux-gnu-
@@@@@@@@@@@ 111 OPPO_BUILD_CUSTOMIZE is 
  CHK     include/config/kernel.release
  CHK     include/generated/uapi/linux/version.h
  CHK     include/generated/utsrelease.h
  CC      kernel/bounds.s
<b>kernel/bounds.c:18:2: </b><font color="#CC0000"><b>error: </b></font><b>unexpected token at start of statement</b>
        DEFINE(NR_PAGEFLAGS, __NR_PAGEFLAGS);
<font color="#4E9A06"><b>        ^</b></font>
<b>include/linux/kbuild.h:5:25: </b><font color="#2E3436"><b>note: </b></font>expanded from macro &apos;DEFINE&apos;
        asm volatile(&quot;\n-&gt;&quot; #sym &quot; %0 &quot; #val : : &quot;i&quot; (val))
<font color="#4E9A06"><b>                        ^</b></font>
<b>&lt;inline asm&gt;:2:1: </b><font color="#2E3436"><b>note: </b></font>instantiated into assembly here
-&gt;NR_PAGEFLAGS $21 __NR_PAGEFLAGS
<font color="#4E9A06"><b>^</b></font>
<b>kernel/bounds.c:19:2: </b><font color="#CC0000"><b>error: </b></font><b>unexpected token at start of statement</b>
        DEFINE(MAX_NR_ZONES, __MAX_NR_ZONES);
<font color="#4E9A06"><b>        ^</b></font>
<b>include/linux/kbuild.h:5:25: </b><font color="#2E3436"><b>note: </b></font>expanded from macro &apos;DEFINE&apos;
        asm volatile(&quot;\n-&gt;&quot; #sym &quot; %0 &quot; #val : : &quot;i&quot; (val))
<font color="#4E9A06"><b>                        ^</b></font>
<b>&lt;inline asm&gt;:2:1: </b><font color="#2E3436"><b>note: </b></font>instantiated into assembly here
-&gt;MAX_NR_ZONES $3 __MAX_NR_ZONES
<font color="#4E9A06"><b>^</b></font>
<b>kernel/bounds.c:21:2: </b><font color="#CC0000"><b>error: </b></font><b>unexpected token at start of statement</b>
        DEFINE(NR_CPUS_BITS, ilog2(CONFIG_NR_CPUS));
<font color="#4E9A06"><b>        ^</b></font>
<b>include/linux/kbuild.h:5:25: </b><font color="#2E3436"><b>note: </b></font>expanded from macro &apos;DEFINE&apos;
        asm volatile(&quot;\n-&gt;&quot; #sym &quot; %0 &quot; #val : : &quot;i&quot; (val))
<font color="#4E9A06"><b>                        ^</b></font>
<b>&lt;inline asm&gt;:2:1: </b><font color="#2E3436"><b>note: </b></font>instantiated into assembly here
-&gt;NR_CPUS_BITS $3 ilog2(CONFIG_NR_CPUS)
<font color="#4E9A06"><b>^</b></font>
<b>kernel/bounds.c:23:2: </b><font color="#CC0000"><b>error: </b></font><b>unexpected token at start of statement</b>
        DEFINE(SPINLOCK_SIZE, sizeof(spinlock_t));
<font color="#4E9A06"><b>        ^</b></font>
<b>include/linux/kbuild.h:5:25: </b><font color="#2E3436"><b>note: </b></font>expanded from macro &apos;DEFINE&apos;
        asm volatile(&quot;\n-&gt;&quot; #sym &quot; %0 &quot; #val : : &quot;i&quot; (val))
<font color="#4E9A06"><b>                        ^</b></font>
<b>&lt;inline asm&gt;:2:1: </b><font color="#2E3436"><b>note: </b></font>instantiated into assembly here
-&gt;SPINLOCK_SIZE $4 sizeof(spinlock_t)
<font color="#4E9A06"><b>^</b></font>
4 errors generated.
Kbuild:45: recipe for target &apos;kernel/bounds.s&apos; failed
make[1]: *** [kernel/bounds.s] Error 1
Makefile:1129: recipe for target &apos;prepare0&apos; failed
make: *** [prepare0] Error 2
</code>
</pre>
</figure>

<h4 id="problem-analysis">Problem analysis</h4>

<p><code class="highlighter-rouge">KBuild</code> abuses the asm statement to write to a file and <code class="highlighter-rouge">clang</code> chokes about these invalid asm statements. Hack it even more by fooling this is actual valid asm code.
This is fixed in commit <a href="https://github.com/N00bKernel/stanlee/commit/af41c50628c23bcfbe1f56756469c2e4085bc1d0">af41c50628c23bcfbe1f56756469c2e4085bc1d0</a>.</p>

<h4 id="download-patch">Download patch</h4>

<p>Below patch(es) can be applied to fix this issue:</p>
<ul>
  <li><a href="https://raw.githubusercontent.com/chankruze/studious-waddle/master/chankruze-001-kbuild-clang_macro_define.patch">chankruze-001-kbuild-clang_macro_define.patch</a></li>
</ul>



<p class="end-of-post"><i class="fas fa-terminal"></i> <span class="quick-blink">Thanks For Reading</span></p>

<div id="disqus_thread"></div>

<script>

  /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
  */

  // var disqus_config = function () {
  // this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
  // this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
  // };

  (function () { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://geekofia-blog.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<script src="/assets/js/run_prettify.js"></script>
    </div>

    <!-- Footer -->
    <!-- footer -->
<footer class="footer">
    <div class="container clearfix">
        <div class="float-left">
            <span>Made with <i class="fas fa-heart"></i> by <a href="https://github.com/chankruze">chankruze</a>
            </span>
        </div>
        <div class="ml-auto float-right">
            <span class="links">
                <a class="navbar-brand" href="https://paypal.me/chankruze" target="_blank"><i
                        class="fab fa-paypal"></i></a>
                <a class="navbar-brand" href="https://t.me/geekofia" target="_blank"><i class="fab fa-telegram"></i></a>
                <a class="navbar-brand" href="https://instagram.com/chankruze" target="_blank"><i
                        class="fab fa-instagram"></i></a>
            </span>
        </div>
    </div>
</footer>

    <!-- Scripts -->
    <script src="/assets/js/jquery-3.4.1.min.js"></script>
    <script src="/assets/js/popper.min.js"></script>
    <script src="/assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="/assets/js/index.js"></script>
    <script id="dsq-count-scr" src="//geekofia.disqus.com/count.js" async></script>
</body>

</html>